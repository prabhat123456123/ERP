<%- include('../partials/top-bar') %>
      <!-- Site wrapper -->
      <div class="wrapper">
         <%- include('../partials/header') %>
         <!-- =============================================== -->
         <!-- Left side column. contains the sidebar -->
       <%- include('../partials/sidebar') %>
         <!-- =============================================== -->
         <!-- Content Wrapper. Contains page content -->
         <div class="content-wrapper">
            <!-- Content Header (Page header) -->
            <section class="content-header">
               <div class="header-icon">
                  <i class="fa fa-dashboard"></i>
               </div>
               <div class="header-title">
                  <div class="row">
                     <div class="form-group col-lg-4" >
                  <h1>SCHOOL ERP Admin Dashboard</h1>
                  <small>Very detailed & featured admin.</small>
                  </div>
               
                 
                                 </div>
               </div>
               
            </section>
            <!-- Main content -->
            <section class="content">
                    <div class="row">
                   <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
                     <div class="panel panel-bd lobidisable">
                        <div class="panel-heading">
                           <div class="panel-title">
                              <h4>Count in Pie chart</h4>
                           </div>
                        </div>
                        <div class="panel-body">
                           <canvas id="pieChart" style="display: block; height: 282px; width: 565px;"></canvas>
                        </div>
                     </div>
                  </div>
                   <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
                     <div class="panel panel-bd lobidisable">
                        <div class="panel-heading">
                           <div class="panel-title">
                              <h4>Attendance % </h4>
                           </div>
                        </div>
                        <div class="panel-body">
                           <canvas id="barChart" style="display: block; height: 282px; width: 565px;"></canvas>
                        </div>
                     </div>
                  </div>
                  <!-- Barchart -->
                
                  <!-- bar chart -->
                  <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6">
                     <div class="panel panel-bd lobidisable">
                        <div class="panel-heading">
                           <div class="panel-title">
                              <h4>Top 5 Student</h4>
                           </div>
                        </div>
                        <div class="panel-body">
                           <canvas id="singelBarChart" style="display: block; height: 282px; width: 565px;"></canvas>
                        </div>
                     </div>
                  </div>
             
                 
                    
               </div>
              
             
            </section>
            <!-- /.content -->
         </div>
         <!-- /.content-wrapper -->
        <%- include('../partials/footer') %>
      </div>
      <!-- /.wrapper -->
      <!-- Start Core Plugins
         =====================================================================-->
   <%- include('../partials/footer-script') %>
   <script >
   
// let startDates;
// let endDates;
// $(function() {

//     var start = moment().subtract(29, 'days');
//     var end = moment();

//     function cb(start, end) {
//         $('#reportrange span').html(start.format('YYYY-MM-DD') + ' - ' + end.format('YYYY-MM-DD'));
//         startDates = start.format('YYYY-MM-DD');
//          endDates = end.format('YYYY-MM-DD');
//     }

//     $('#reportrange').daterangepicker({
//         startDate: start,
//         endDate: end,
//         ranges: {
//            'Today': [moment(), moment()],
//            'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
//            'Last 7 Days': [moment().subtract(6, 'days'), moment()],
//            'Last 30 Days': [moment().subtract(29, 'days'), moment()],
//            'This Month': [moment().startOf('month'), moment().endOf('month')],
//            'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
//         }
//     }, cb);

//     cb(start, end);
    
// });
// var dataTable;
// var sale_chart;

//   dataTable = $("#sample_data").DataTable({
// 			"processing": true,
// 			"serverSide": true,
// 			  "order": [],
// 			ajax: {
// 				url: `/get-dashboard-data-by-school`,
// 				type: "POST",
			
// 			},
// 			columns: [{ data: "created_at" }, { data: "attendance_status" }, {data:"check_in"},{data:"check_out"}],
// 		});
      
// $(document).on('click', '#filter_records', function () {
//    if ($.fn.DataTable.isDataTable('#sample_data')) {
//                     $('#sample_data').DataTable().destroy();
//                 }

//     // Initialize DataTable
//     dataTable = $('#sample_data').DataTable({
//         "processing": true,
//         "serverSide": true,
       
//         "order": [],
//         "ajax": {
//             url: "/get-dashboard-data-by-school",
//             type: "POST",
//             data: {
//                 startDates: startDates,
//                 endDates: endDates
//             },
//         },
//         columns: [{
//                 data: "created_at"
//             },
//             {
//                 data: "attendance_status"
//             },
//             {
//                 data: "check_in"
//             },
//             {
//                 data: "check_out"
//             },
//         ],
//         "drawCallback": function (settings) {
//             var sales_date = [];
//             var sale = [];

//             // Populate data arrays for the chart
//             for (var count = 0; count < settings.aoData.length; count++) {
//                 sales_date.push(settings.aoData[count]._aData[2]);
//                 sale.push(parseFloat(settings.aoData[count]._aData[1]));
//             }

//             // Update chart data
//             var chart_data = {
//                 labels: sales_date,
//                 datasets: [{
//                     label: 'Sales',
//                     backgroundColor: 'rgb(255, 205, 86)',
//                     color: '#fff',
//                     data: sale
//                 }]
//             };

//             // Destroy existing chart instance if it exists
//             if (sale_chart) {
//                 sale_chart.destroy();
//             }

//             // Create new chart instance
//             var group_chart3 = $('#bar_chart');
//             sale_chart = new Chart(group_chart3, {
//                 type: 'bar',
//                 data: chart_data
//             });
//         }
//     });
// });
$(document).ready(function(){
  $.ajax({
        url: '/get-dashboard-data-by-school',
        type: "POST",
        data: {a:"p"},
        success: function (data) {
    console.log(data);
    $('#numOfteacher').val(`${data.numOFFac}`);
    $('#numOfStudent').val(`${data.numOfStd}`);
     //pie chart
             var ctx = document.getElementById("pieChart");
             var myChart = new Chart(ctx, {
                 type: 'pie',
                 data: {
                     datasets: [{
                             data: [data.numOfStd,data.numOFFac],
                             backgroundColor: [
                                 "green",
                                 "pink",
                               
                             ],
                             hoverBackgroundColor: [
                                 "green",
                                 "pink",
                                
                             ]
         
                         }],
                     labels: [
                        "Number of Student",
                        "Number of Teacher",

                     ]
                 },
                 options: {
                     responsive: true
                 }
             });

               //bar chart
         var ctxBar = document.getElementById("barChart");
         var myChart = new Chart(ctxBar, {
         type: 'bar',
         data: {
         labels: ["Attendance Percentage (%)"],
         datasets: [
         {
         label: "Student",
         data: [data.studentAttendancePercentage],
         borderColor: "rgba(0, 150, 136, 0.8)",
         width: "1",
         borderWidth: "0",
         backgroundColor: "rgba(0, 150, 136, 0.8)"
         },
         {
         label: "Faculty",
         data: [data.facultyAttendancePercentage],
         borderColor: "rgba(51, 51, 51, 0.55)",
         width: "1",
         borderWidth: "0",
         backgroundColor: "rgba(51, 51, 51, 0.55)"
         }
         ]
         },
         options: {
         scales: {
         yAxes: [{
             ticks: {
                 beginAtZero: true
             }
         }]
         }
         }
         });
         let labelData=[];
         let datas=[];
         for (let i = 0; i < data.CountTopStudent.length; i++) {
           labelData.push(data.CountTopStudent[i].name);
           datas.push(data.CountTopStudent[i].max_obtained_marks)
            
         }
 // single bar chart
         var ctxTopStud = document.getElementById("singelBarChart");
         var myChart = new Chart(ctxTopStud, {
         type: 'bar',
         data: {
         labels: labelData,
         datasets: [
         {
         label: "Obtained Marks",
         data:datas,
         borderColor: "rgba(0, 150, 136, 0.8)",
         width: "1",
         borderWidth: "0",
         backgroundColor: "rgba(0, 150, 136, 0.8)"
         }
         ]
         },
         options: {
         scales: {
         yAxes: [{
             ticks: {
                 beginAtZero: true
             }
         }]
         }
         }
         });
        }
    });
})
// $(document).ready(function(){

     
   //   dataTable = $("#sample_data").DataTable({
	// 		processing: true,
	// 		serverSide: true,
			
	// 		ajax: {
	// 			url: `/get-dashboard-data-by-school`,
	// 			type: "POST",
			
	// 		},
	// 		columns: [{ data: "created_at" }, { data: "attendance_status" }, {data:"check_in"},{data:"check_out"}],
	// 	});
// fetch_data();
//     var sale_chart;

//     function fetch_data(start_date = '', end_date = '')
//     {
// if ($.fn.DataTable.isDataTable('#sample_data')) {
//                     $('#sample_data').DataTable().destroy();
//                 }
//          dataTable = $('#sample_data').DataTable({
//             "processing" : true,
//             "serverSide" : true,
//             "order" : [],
//             "ajax" : {
//                 url:"/get-dashboard-data-by-school",
//                 type:"POST",
//                 data:{action:'fetch', start_date:start_date, end_date:end_date}
//             },
//             "drawCallback" : function(settings)
//             {
//                 var sales_date = [];
//                 var sale = [];

//                 for(var count = 0; count < settings.aoData.length; count++)
//                 {
//                     sales_date.push(settings.aoData[count]._aData[2]);
//                     sale.push(parseFloat(settings.aoData[count]._aData[1]));
//                 }

//                 var chart_data = {
//                     labels:sales_date,
//                     datasets:[
//                         {
//                             label : 'Sales',
//                             backgroundColor : 'rgb(255, 205, 86)',
//                             color : '#fff',
//                             data:sale
//                         }
//                     ]   
//                 };

//                 var group_chart3 = $('#bar_chart');

//                 if(sale_chart)
//                 {
//                     sale_chart.destroy();
//                 }

//                 sale_chart = new Chart(group_chart3, {
//                     type:'bar',
//                     data:chart_data
//                 });
//             }
//         });
//     }
 
    

// var start = moment().subtract(29, 'days');
// var end = moment();

// function cb(start, end) {
//     $('#reportrange span').html(start.format('MMMM D, YYYY') + ' - ' + end.format('MMMM D, YYYY'));
// }

// $('#reportrange').daterangepicker({
//     startDate: start,
//     endDate: end,
//     ranges: {
//        'Today': [moment(), moment()],
//        'Yesterday': [moment().subtract(1, 'days'), moment().subtract(1, 'days')],
//        'Last 7 Days': [moment().subtract(6, 'days'), moment()],
//        'Last 30 Days': [moment().subtract(29, 'days'), moment()],
//        'This Month': [moment().startOf('month'), moment().endOf('month')],
//        'Last Month': [moment().subtract(1, 'month').startOf('month'), moment().subtract(1, 'month').endOf('month')]
//     }
// }, function(start, end){

//     $('#sample_data').DataTable().destroy();

//     fetch_data(start, end);

// });

// cb(start, end);



// });
  
$(document).on('click', '#filter_records_by_student', function () {
    // Fetch filter values or parameters
    var startDates = $('#start_date_input').val();
    var endDates = $('#end_date_input').val();

    // Destroy existing DataTable
    if (dataTable) {
        dataTable.destroy();
    }

    // Fetch data and redraw DataTable
    dataTable = $('#sample_data').DataTable({
        "processing": true,
        "serverSide": true,
        dom: 'Bfrtip',
        buttons: [
            {
                extend: 'csv',
                exportOptions: {
                    columns: 'th:not(:last-child)'
                }
            },
            {
                extend: 'pdf',
                exportOptions: {
                    columns: 'th:not(:last-child)'
                }
            }
        ],
        "order": [],
        "ajax": {
            url: "/attendance/get-report-by-student",
            type: "POST",
            data: { startDates: startDates, endDates: endDates },
        },
        columns: [
            { data: "created_at" },
            { data: "attendance_status" },
            { data: "check_in" },
            { data: "check_out" },
        ],
        "initComplete": function () {
            // After DataTable initialization, draw the chart
            drawChart();
        }
    });
});

// Function to draw chart
function drawChart() {
    var labels = [];
    var data = [];

    // Extract data from DataTable
    $('#sample_data').DataTable().rows().every(function () {
        var rowData = this.data();
        labels.push(rowData.created_at);
        // Assuming attendance_status contains the data for the chart
        data.push(rowData.attendance_status);
    });

    // Destroy existing chart if any
    if (myChart) {
        myChart.destroy();
    }

    var ctx = document.getElementById('myChart').getContext('2d');
    myChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Attendance Status',
                data: data,
                backgroundColor: 'rgba(255, 99, 132, 0.2)',
                borderColor: 'rgba(255, 99, 132, 1)',
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
}

   </script>